<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/starts.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/echarts.js"></script>
  <script src="../js/china.js"></script>
  <link rel="stylesheet" href="../css/DJModel.css">
  <title>党建大数据</title>
  <style>
    .mapper {
      width: 900px;
      height: 500px;
    }

    html {
      font-size: 16px;
    }

    @media screen and (min-width: 375px) {
      html {
        /* iPhone6的375px尺寸作为16px基准，414px正好18px大小, 600 20px */
        font-size: calc(100% + 2 * (100vw - 375px) / 39);
        font-size: calc(16px + 2 * (100vw - 375px) / 39);
      }
    }

    @media screen and (min-width: 414px) {
      html {
        /* 414px-1000px每100像素宽字体增加1px(18px-22px) */
        font-size: calc(112.5% + 4 * (100vw - 414px) / 586);
        font-size: calc(18px + 4 * (100vw - 414px) / 586);
      }
    }

    @media screen and (min-width: 600px) {
      html {
        /* 600px-1000px每100像素宽字体增加1px(20px-24px) */
        font-size: calc(125% + 4 * (100vw - 600px) / 400);
        font-size: calc(20px + 4 * (100vw - 600px) / 400);
      }
    }

    @media screen and (min-width: 1000px) {
      html {
        /* 1000px往后是每100像素0.5px增加 */
        font-size: calc(137.5% + 6 * (100vw - 1000px) / 1000);
        font-size: calc(22px + 6 * (100vw - 1000px) / 1000);
      }
    }
  </style>
</head>

<body>
  <div id="boxes">
    <div class="outer_box">
      <div class="body_box">
        <div class="body_border">
          <div class="body_header">

          </div>
          <div class="body_middle">
            <div id="mainMap" class="mapper"></div>
            <div id="mainRadar" class="mapper"></div>
            <div id="mainMigrate" class="mapper"></div>
            <div id="mainGames" class="mapper"></div>
          </div>
          <div class="body_bottom">

          </div>
        </div>
      </div>
    </div>
  </div>
  <canvas id="starts" width="100%" height="100%"></canvas>
</body>
<script>
  $(function () {
    //canvas背景
    canvas("starts", 230, 1000, 50, 2, 999999, 0.5);
    mapper();
    radar();
    // migrate();
    // games();
  })


  function mapper() {
    // --- 地图 ---
    var myCharts = echarts.init(document.getElementById('mainMap'))

    var mapName = 'china'
    var data = [{
        name: "北京",
        value: 199
      },
      {
        name: "天津",
        value: 42
      },
      {
        name: "河北",
        value: 102
      },
      {
        name: "山西",
        value: 81
      },
      {
        name: "内蒙古",
        value: 47
      },
      {
        name: "辽宁",
        value: 67
      },
      {
        name: "吉林",
        value: 82
      },
      {
        name: "黑龙江",
        value: 123
      },
      {
        name: "上海",
        value: 24
      },
      {
        name: "江苏",
        value: 92
      },
      {
        name: "浙江",
        value: 114
      },
      {
        name: "安徽",
        value: 109
      },
      {
        name: "福建",
        value: 116
      },
      {
        name: "江西",
        value: 91
      },
      {
        name: "山东",
        value: 119
      },
      {
        name: "河南",
        value: 137
      },
      {
        name: "湖北",
        value: 116
      },
      {
        name: "湖南",
        value: 114
      },
      {
        name: "重庆",
        value: 91
      },
      {
        name: "四川",
        value: 125
      },
      {
        name: "贵州",
        value: 62
      },
      {
        name: "云南",
        value: 83
      },
      {
        name: "西藏",
        value: 9
      },
      {
        name: "陕西",
        value: 80
      },
      {
        name: "甘肃",
        value: 56
      },
      {
        name: "青海",
        value: 10
      },
      {
        name: "宁夏",
        value: 18
      },
      {
        name: "新疆",
        value: 180
      },
      {
        name: "广东",
        value: 123
      },
      {
        name: "广西",
        value: 59
      },
      {
        name: "海南",
        value: 14
      },
    ];

    var geoCoordMap = {};
    var toolTipData = [{
        name: "北京",
        value: [{
          name: "科技人才总数",
          value: 95
        }, {
          name: "理科",
          value: 82
        }]
      },
      {
        name: "天津",
        value: [{
          name: "文科",
          value: 22
        }, {
          name: "理科",
          value: 20
        }]
      },
      {
        name: "河北",
        value: [{
          name: "文科",
          value: 60
        }, {
          name: "理科",
          value: 42
        }]
      },
      {
        name: "山西",
        value: [{
          name: "文科",
          value: 40
        }, {
          name: "理科",
          value: 41
        }]
      },
      {
        name: "内蒙古",
        value: [{
          name: "文科",
          value: 23
        }, {
          name: "理科",
          value: 24
        }]
      },
      {
        name: "辽宁",
        value: [{
          name: "文科",
          value: 39
        }, {
          name: "理科",
          value: 28
        }]
      },
      {
        name: "吉林",
        value: [{
          name: "文科",
          value: 41
        }, {
          name: "理科",
          value: 41
        }]
      },
      {
        name: "黑龙江",
        value: [{
          name: "文科",
          value: 35
        }, {
          name: "理科",
          value: 31
        }]
      },
      {
        name: "上海",
        value: [{
          name: "文科",
          value: 12
        }, {
          name: "理科",
          value: 12
        }]
      },
      {
        name: "江苏",
        value: [{
          name: "文科",
          value: 47
        }, {
          name: "理科",
          value: 45
        }]
      },
      {
        name: "浙江",
        value: [{
          name: "文科",
          value: 57
        }, {
          name: "理科",
          value: 57
        }]
      },
      {
        name: "安徽",
        value: [{
          name: "文科",
          value: 57
        }, {
          name: "理科",
          value: 52
        }]
      },
      {
        name: "福建",
        value: [{
          name: "文科",
          value: 59
        }, {
          name: "理科",
          value: 57
        }]
      },
      {
        name: "江西",
        value: [{
          name: "文科",
          value: 49
        }, {
          name: "理科",
          value: 42
        }]
      },
      {
        name: "山东",
        value: [{
          name: "文科",
          value: 67
        }, {
          name: "理科",
          value: 52
        }]
      },
      {
        name: "河南",
        value: [{
          name: "文科",
          value: 69
        }, {
          name: "理科",
          value: 68
        }]
      },
      {
        name: "湖北",
        value: [{
          name: "文科",
          value: 60
        }, {
          name: "理科",
          value: 56
        }]
      },
      {
        name: "湖南",
        value: [{
          name: "文科",
          value: 62
        }, {
          name: "理科",
          value: 52
        }]
      },
      {
        name: "重庆",
        value: [{
          name: "文科",
          value: 47
        }, {
          name: "理科",
          value: 44
        }]
      },
      {
        name: "四川",
        value: [{
          name: "文科",
          value: 65
        }, {
          name: "理科",
          value: 60
        }]
      },
      {
        name: "贵州",
        value: [{
          name: "文科",
          value: 32
        }, {
          name: "理科",
          value: 30
        }]
      },
      {
        name: "云南",
        value: [{
          name: "文科",
          value: 42
        }, {
          name: "理科",
          value: 41
        }]
      },
      {
        name: "西藏",
        value: [{
          name: "文科",
          value: 5
        }, {
          name: "理科",
          value: 4
        }]
      },
      {
        name: "陕西",
        value: [{
          name: "文科",
          value: 38
        }, {
          name: "理科",
          value: 42
        }]
      },
      {
        name: "甘肃",
        value: [{
          name: "文科",
          value: 28
        }, {
          name: "理科",
          value: 28
        }]
      },
      {
        name: "青海",
        value: [{
          name: "文科",
          value: 5
        }, {
          name: "理科",
          value: 5
        }]
      },
      {
        name: "宁夏",
        value: [{
          name: "文科",
          value: 10
        }, {
          name: "理科",
          value: 8
        }]
      },
      {
        name: "新疆",
        value: [{
          name: "文科",
          value: 36
        }, {
          name: "理科",
          value: 31
        }]
      },
      {
        name: "广东",
        value: [{
          name: "文科",
          value: 63
        }, {
          name: "理科",
          value: 60
        }]
      },
      {
        name: "广西",
        value: [{
          name: "文科",
          value: 29
        }, {
          name: "理科",
          value: 30
        }]
      },
      {
        name: "海南",
        value: [{
          name: "文科",
          value: 8
        }, {
          name: "理科",
          value: 6
        }]
      },
    ];

    /*获取地图数据*/
    myCharts.showLoading();
    var mapFeatures = echarts.getMap(mapName).geoJson.features;
    myCharts.hideLoading();
    mapFeatures.forEach(function (v) {
      // 地区名称
      var name = v.properties.name;
      // 地区经纬度
      geoCoordMap[name] = v.properties.cp;

    });

    console.log(data)
    console.log(toolTipData)
    var max = 480,
      min = 9; // todo 
    var maxSize4Pin = 100,
      minSize4Pin = 20;

    var convertData = function (data) {
      var res = [];
      for (var i = 0; i < data.length; i++) {
        var geoCoord = geoCoordMap[data[i].name];
        if (geoCoord) {
          res.push({
            name: data[i].name,
            value: geoCoord.concat(data[i].value),
          });
        }
      }
      return res;
    };



    var option = {
      tooltip: {
        padding: 0,
        enterable: true,
        transitionDuration: 1,
        textStyle: {
          color: '#000',
          decoration: 'none',
        },
        // position: function (point, params, dom, rect, size) {
        //   return [point[0], point[1]];
        // },
        formatter: function (params) {
          // console.log(params)
          var tipHtml = '';
          tipHtml =
            '<div style="width:160px;height:140px;background:rgba(22,80,158,0.8);border:1px solid rgba(7,166,255,0.7)">' +
            '<div style="width:158px;height:40px;line-height:40px;border-bottom:2px solid rgba(7,166,255,0.7);padding:0 20px">' +
            '<i style="display:inline-block;width:8px;height:8px;background:#16d6ff;border-radius:40px;">' +
            '</i>' +
            '<span style="margin-left:10px;color:#fff;font-size:16px;">' + params.name + '</span>' + '</div>' +
            '<div style="padding:20px">' +
            '<p style="color:#fff;font-size:12px;">' +
            '<i style="display:inline-block;width:10px;height:10px;background:#16d6ff;border-radius:40px;margin:0 8px">' +
            '</i>' +
            '党员：' + '<span style="color:#11ee7d;margin:0 6px;">' + params.data.value + '</span>' + '人' +
            '</p>' +
            '</div>' + '</div>';
          return tipHtml;
        }

      },

      visualMap: {
        show: true,
        min: 0,
        max: 200,
        left: '10%',
        top: 'bottom',
        calculable: true,
        seriesIndex: [1],
        inRange: {
          color: ['#04387b', '#467bc0'] // 蓝绿
        }
      },
      geo: {
        show: true,
        map: mapName,
        label: {
          normal: {
            show: false
          },
          emphasis: {
            show: false,
          }
        },
        roam: false,
        itemStyle: {
          normal: {
            areaColor: '#023677',
            borderColor: '#1180c7',
          },
          emphasis: {
            areaColor: '#4499d0',
          }
        }
      },
      series: [{
          name: '散点',
          type: 'scatter',
          coordinateSystem: 'geo',
          data: convertData(data),
          symbolSize: function (val) {
            return val[2] / 10;
          },
          label: {
            normal: {
              formatter: '{b}',
              position: 'right',
              show: true
            },
            emphasis: {
              show: true
            }
          },
          itemStyle: {
            normal: {
              color: '#fff'
            }
          }
        },
        {
          type: 'map',
          map: mapName,
          geoIndex: 0,
          aspectScale: 0.75, //长宽比
          showLegendSymbol: false, // 存在legend时显示
          label: {
            normal: {
              show: true
            },
            emphasis: {
              show: false,
              textStyle: {
                color: '#fff'
              }
            }
          },
          roam: true,
          itemStyle: {
            normal: {
              areaColor: '#031525',
              borderColor: '#3B5077',
            },
            emphasis: {
              areaColor: '#2B91B7'
            }
          },
          animation: false,
          data: data
        },
        {
          name: '点',
          type: 'scatter',
          coordinateSystem: 'geo',
          zlevel: 6,
        },
        {
          name: 'Top 5',
          type: 'effectScatter',
          coordinateSystem: 'geo',
          data: convertData(data.sort(function (a, b) {
            return b.value - a.value;
          }).slice(0, 10)),
          symbolSize: function (val) {
            return val[2] / 10;
          },
          showEffectOn: 'render',
          rippleEffect: {
            brushType: 'stroke'
          },
          hoverAnimation: true,
          label: {
            normal: {
              formatter: '{b}',
              position: 'left',
              show: false
            }
          },
          itemStyle: {
            normal: {
              color: 'yellow',
              shadowBlur: 10,
              shadowColor: 'yellow'
            }
          },
          zlevel: 1
        },

      ]
    };

    myCharts.setOption(option)
  }

  function radar() {
    // --- 雷达 ---
    var myCharts = echarts.init(document.getElementById('mainRadar'))

    var colorArr = ["#218de0", "#01cbb3", "#85e647", "#5d5cda", "#05c5b0", "#c29927"];
    var colorAlpha = ['rgba(60,170,211,0.05)', 'rgba(1,203,179,0.05)', 'rgba(133,230,71,0.05)', 'rgba(93,92,218,0.05)',
      'rgba(5,197,176,0.05)', 'rgba(194,153,39,0.05)'
    ]
    var option = {
      backgroundColor: "#090e36",
      grid: {
        left: -100,
        top: 50,
        bottom: 10,
        right: 10,
        containLabel: true
      },
      tooltip: {
        trigger: 'item',
        formatter: "{b} : {c} ({d}%)"
      },
      legend: {
        show: false
      },

      polar: {},
      angleAxis: {
        interval: 1,
        type: 'category',
        data: [],
        z: 10,
        axisLine: {
          show: false,
          lineStyle: {
            color: "#0B4A6B",
            width: 1,
            type: "solid"
          },
        },
        axisLabel: {
          interval: 0,
          show: true,
          color: "#0B4A6B",
          margin: 8,
          fontSize: 16
        },
      },
      radiusAxis: {
        min: 20,
        max: 120,
        interval: 20,
        axisLine: {
          show: false,
          lineStyle: {
            color: "#0B3E5E",
            width: 1,
            type: "solid"
          },
        },
        axisLabel: {
          formatter: '{value} %',
          show: false,
          padding: [0, 0, 20, 0],
          color: "#0B3E5E",
          fontSize: 16
        },
        splitLine: {
          lineStyle: {
            color: "#07385e",
            width: 2,
            type: "dashed"
          }
        }
      },
      calculable: true,
      series: [{
        stack: 'a',
        type: 'pie',
        radius: '80%',
        roseType: 'radius',
        zlevel: 10,
        startAngle: 100,
        label: {
          normal: {
            formatter: ['{b|{b}}', '{d|{d}%}'].join('\n'),
            rich: {
              b: {
                color: '#3bd2fe',
                fontSize: 14,
                lineHeight: 20
              },
              d: {
                color: '#d0fffc',
                fontSize: 14,
                height: 20
              },
            },
          }
        },
        labelLine: {
          normal: {
            show: true,
            length: 10,
            length2: 45,
            lineStyle: {
              color: '#0096b1'

            }
          },
          emphasis: {
            show: false
          }
        },
        data: [{
            value: 63,
            name: '容量小设备老旧',
            itemStyle: {
              borderColor: colorArr[0],
              borderWidth: 2,
              shadowBlur: 20,
              shadowColor: "#41a8f8",
              shadowOffsetx: 25,
              shadowOffsety: 20,
              color: colorAlpha[0]
            }
          },
          {
            value: 27,
            name: '季节性企业用电',
            itemStyle: {
              borderColor: colorArr[1],
              borderWidth: 2,
              shadowBlur: 20,
              shadowColor: colorArr[1],
              shadowOffsetx: 25,
              shadowOffsety: 20,
              color: colorAlpha[1]
            }
          },
          {
            value: 7,
            name: '企业用电高峰',
            itemStyle: {
              borderColor: colorArr[2],
              borderWidth: 2,
              shadowBlur: 20,
              shadowColor: colorArr[2],
              shadowOffsetx: 25,
              shadowOffsety: 20,
              color: colorAlpha[2]
            }
          },
          {
            value: 13,
            name: '节假日',
            itemStyle: {
              borderColor: colorArr[3],
              borderWidth: 2,
              shadowBlur: 20,
              shadowColor: colorArr[3],
              shadowOffsetx: 25,
              shadowOffsety: 20,
              color: colorAlpha[3]
            }
          },
          {
            value: 10,
            name: '临时用电',
            itemStyle: {
              borderColor: colorArr[4],
              borderWidth: 2,
              shadowBlur: 20,
              shadowColor: colorArr[4],
              shadowOffsetx: 25,
              shadowOffsety: 20,
              color: colorAlpha[4]
            }
          },
          {
            value: 6,
            name: '三相用电不平衡',
            itemStyle: {
              borderColor: colorArr[5],
              borderWidth: 2,
              shadowBlur: 20,
              shadowColor: colorArr[5],
              shadowOffsetx: 25,
              shadowOffsety: 20,
              color: colorAlpha[5]
            }
          }
        ]
      }, ]
    }

    myCharts.setOption(option)
  }

  function migrate() {
    // --- 迁徙 ---
    var myCharts = echarts.init(document.getElementById('mainMigrate'))
    var geoCoordMap = {
      '新疆玛纳斯基地': [86.22, 44.30],
      '九江': [116.00, 29.70],
      '新乡': [116.402217, 35.311657],
      ' ': [79.92, 37.12],
      '  ': [86.85, 47.70],
      '若羌县': [88.17, 39.02],
      '上海': [121.4648, 31.2891],
      '东莞': [113.8953, 22.901],
      '东营': [118.7073, 37.5513],
      '中山': [113.4229, 22.478],
      '临汾': [111.4783, 36.1615],
      '临沂': [118.3118, 35.2936],
      '丹东': [124.541, 40.4242],
      '丽水': [119.5642, 28.1854],
      '乌鲁木齐': [87.9236, 43.5883],
      '佛山': [112.8955, 23.1097],
      '保定': [115.0488, 39.0948],
      '兰州': [103.5901, 36.3043],
      '包头': [110.3467, 41.4899],
      '北京': [116.4551, 40.2539],
      '北海': [109.314, 21.6211],
      '南京': [118.8062, 31.9208],
      '南宁': [108.479, 23.1152],
      '南昌': [116.0046, 28.6633],
      '南通': [121.1023, 32.1625],
      '厦门': [118.1689, 24.6478],
      '台州': [121.1353, 28.6688],
      '合肥': [117.29, 32.0581],
      '呼和浩特': [111.4124, 40.4901],
      '咸阳': [108.4131, 34.8706],
      '哈尔滨': [127.9688, 45.368],
      '唐山': [118.4766, 39.6826],
      '嘉兴': [120.9155, 30.6354],
      '大同': [113.7854, 39.8035],
      '大连': [122.2229, 39.4409],
      '天津': [117.4219, 39.4189],
      '太原': [112.3352, 37.9413],
      '威海': [121.9482, 37.1393],
      '宁波': [121.5967, 29.6466],
      '宝鸡': [107.1826, 34.3433],
      '宿迁': [118.5535, 33.7775],
      '常州': [119.4543, 31.5582],
      '广州': [113.5107, 23.2196],
      '廊坊': [116.521, 39.0509],
      '延安': [109.1052, 36.4252],
      '张家口': [115.1477, 40.8527],
      '徐州': [117.5208, 34.3268],
      '德州': [116.6858, 37.2107],
      '惠州': [114.6204, 23.1647],
      '成都': [103.9526, 30.7617],
      '扬州': [119.4653, 32.8162],
      '承德': [117.5757, 41.4075],
      '拉萨': [91.1865, 30.1465],
      '无锡': [120.3442, 31.5527],
      '日照': [119.2786, 35.5023],
      '昆明': [102.9199, 25.4663],
      '杭州': [119.5313, 29.8773],
      '枣庄': [117.323, 34.8926],
      '柳州': [109.3799, 24.9774],
      '株洲': [113.5327, 27.0319],
      '武汉': [114.3896, 30.6628],
      '汕头': [117.1692, 23.3405],
      '江门': [112.6318, 22.1484],
      '沈阳': [123.1238, 42.1216],
      '沧州': [116.8286, 38.2104],
      '河源': [114.917, 23.9722],
      '泉州': [118.3228, 25.1147],
      '泰安': [117.0264, 36.0516],
      '泰州': [120.0586, 32.5525],
      '济南': [117.1582, 36.8701],
      '济宁': [116.8286, 35.3375],
      '海口': [110.3893, 19.8516],
      '淄博': [118.0371, 36.6064],
      '淮安': [118.927, 33.4039],
      '深圳': [114.5435, 22.5439],
      '清远': [112.9175, 24.3292],
      '温州': [120.498, 27.8119],
      '渭南': [109.7864, 35.0299],
      '湖州': [119.8608, 30.7782],
      '湘潭': [112.5439, 27.7075],
      '滨州': [117.8174, 37.4963],
      '潍坊': [119.0918, 36.524],
      '烟台': [120.7397, 37.5128],
      '玉溪': [101.9312, 23.8898],
      '珠海': [113.7305, 22.1155],
      '盐城': [120.2234, 33.5577],
      '盘锦': [121.9482, 41.0449],
      '石家庄': [114.4995, 38.1006],
      '福州': [119.4543, 25.9222],
      '秦皇岛': [119.2126, 40.0232],
      '绍兴': [120.564, 29.7565],
      '聊城': [115.9167, 36.4032],
      '肇庆': [112.1265, 23.5822],
      '舟山': [122.2559, 30.2234],
      '苏州': [120.6519, 31.3989],
      '莱芜': [117.6526, 36.2714],
      '菏泽': [115.6201, 35.2057],
      '营口': [122.4316, 40.4297],
      '葫芦岛': [120.1575, 40.578],
      '衡水': [115.8838, 37.7161],
      '衢州': [118.6853, 28.8666],
      '西宁': [101.4038, 36.8207],
      '西安': [109.1162, 34.2004],
      '贵阳': [106.6992, 26.7682],
      '连云港': [119.1248, 34.552],
      '邢台': [114.8071, 37.2821],
      '邯郸': [114.4775, 36.535],
      '郑州': [113.4668, 34.6234],
      '鄂尔多斯': [108.9734, 39.2487],
      '重庆': [107.7539, 30.1904],
      '金华': [120.0037, 29.1028],
      '铜川': [109.0393, 35.1947],
      '银川': [106.3586, 38.1775],
      '镇江': [119.4763, 31.9702],
      '长春': [125.8154, 44.2584],
      '长沙': [113.0823, 28.2568],
      '长治': [112.8625, 36.4746],
      '阳泉': [113.4778, 38.0951],
      '青岛': [120.4651, 36.3373],
      '韶关': [113.7964, 24.7028]
    };

    var BJData = [
      [{
        name: '新乡'
      }, {
        name: '新乡',
        value: 200
      }],
      [{
        name: '新乡'
      }, {
        name: '呼和浩特',
        value: 90
      }],
      [{
        name: '新乡'
      }, {
        name: '哈尔滨',
        value: 90
      }],
      [{
        name: '新乡'
      }, {
        name: '石家庄',
        value: 90
      }],
      [{
        name: '新乡'
      }, {
        name: '昆明',
        value: 30
      }],
      [{
        name: '新乡'
      }, {
        name: '北京',
        value: 100
      }],
      [{
        name: '新乡'
      }, {
        name: '长春',
        value: 40
      }],
      [{
        name: '新乡'
      }, {
        name: '重庆',
        value: 40
      }],
      [{
        name: '新乡'
      }, {
        name: '贵阳',
        value: 50
      }],
      [{
        name: '新乡'
      }, {
        name: '南宁',
        value: 30
      }],
      [{
        name: '新乡'
      }, {
        name: '济南',
        value: 10
      }],
      [{
        name: '新乡'
      }, {
        name: '太原',
        value: 40
      }],
      [{
        name: '新乡'
      }, {
        name: '西安',
        value: 60
      }],
      [{
        name: '新乡'
      }, {
        name: '武汉',
        value: 50
      }],
      [{
        name: '新乡'
      }, {
        name: '合肥',
        value: 40
      }],
      [{
        name: '新乡'
      }, {
        name: '南京',
        value: 30
      }],
      [{
        name: '新乡'
      }, {
        name: '沈阳',
        value: 20
      }],
      [{
        name: '新乡'
      }, {
        name: '成都',
        value: 10
      }]
    ];

    var SHData = [
      [{
        name: '九江'
      }, {
        name: '九江',
        value: 200
      }],

      [{
        name: '九江'
      }, {
        name: '长沙',
        value: 95
      }],
      [{
        name: '九江'
      }, {
        name: '武汉',
        value: 30
      }],
      [{
        name: '九江'
      }, {
        name: '南昌',
        value: 20
      }],
      [{
        name: '九江'
      }, {
        name: '合肥',
        value: 70
      }],
      [{
        name: '九江'
      }, {
        name: '南京',
        value: 60
      }],
      [{
        name: '九江'
      }, {
        name: '福州',
        value: 50
      }],
      [{
        name: '九江'
      }, {
        name: '上海',
        value: 100
      }],
      [{
        name: '九江'
      }, {
        name: '深圳',
        value: 100
      }],

    ];

    var GZData = [
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '新疆玛纳斯基地',
        value: 200
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '  ',
        value: 90
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: ' ',
        value: 40
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '呼和浩特',
        value: 90
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '昆明',
        value: 40
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '成都',
        value: 10
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '兰州',
        value: 95
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '银川',
        value: 90
      }],
      [{
        name: '新疆玛纳斯基地'
      }, {
        name: '西宁',
        value: 80
      }],

    ];

    var planePath =
      'path://M.6,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705';

    var convertData = function (data) {
      var res = [];
      for (var i = 0; i < data.length; i++) {
        var dataItem = data[i];
        var fromCoord = geoCoordMap[dataItem[0].name];
        var toCoord = geoCoordMap[dataItem[1].name];
        if (fromCoord && toCoord) {
          res.push([{
            coord: fromCoord
          }, {
            coord: toCoord
          }]);
        }
      }
      return res;
    };

    var color = ['#3ed4ff', '#ffa022', '#a6c84c'];
    var series = [];
    [
      ['新乡', BJData],
      ['九江', SHData],
      ['新疆', GZData]
    ].forEach(function (item, i) {
      series.push({
        name: item[0] + ' Top10',
        type: 'lines',
        zlevel: 1,
        effect: {
          show: true,
          period: 6,
          trailLength: 0.7,
          color: '#fff',
          symbolSize: 3
        },
        lineStyle: {
          normal: {
            color: color[i],
            width: 0,
            curveness: 0.2
          }
        },
        data: convertData(item[1])
      }, {
        name: item[0] + ' Top10',
        type: 'lines',
        zlevel: 2,
        effect: {
          show: true,
          period: 6,
          trailLength: 0,
          symbol: planePath,
          symbolSize: 15
        },
        lineStyle: {
          normal: {
            color: color[i],
            width: 1,
            opacity: 0.4,
            curveness: 0.2
          }
        },
        data: convertData(item[1])
      }, {
        name: item[0] + ' Top10',
        type: 'effectScatter',
        coordinateSystem: 'geo',
        zlevel: 2,
        rippleEffect: {
          brushType: 'stroke'
        },
        label: {
          normal: {
            show: true,
            position: 'right',
            formatter: '{b}'
          }
        },
        symbolSize: function (val) {
          return val[2] / 8;
        },
        itemStyle: {
          normal: {
            color: color[i]
          }
        },
        data: item[1].map(function (dataItem) {
          return {
            name: dataItem[1].name,
            value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
          };
        })
      });
    });

    var option = {
      backgroundColor: '#080a20',
      title: {
        text: '模拟迁徙',
        subtext: '数据纯属虚构',
        left: 'left',
        textStyle: {
          color: '#fff'
        }
      },
      tooltip: {
        trigger: 'item'
      },
      legend: {
        orient: 'vertical',
        top: 'bottom',
        left: 'right',
        data: ['北京 Top10', '上海 Top10', '广州 Top10'],
        textStyle: {
          color: '#fff'
        },
        selectedMode: 'single'
      },
      geo: {
        map: 'china',
        label: {
          emphasis: {
            show: false
          }
        },
        roam: true,
        itemStyle: {
          normal: {
            areaColor: '#132937',
            borderColor: '#0692a4'
          },
          emphasis: {
            areaColor: '#0b1c2d'
          }
        }
      },
      series: series
    };
    myCharts.setOption(option)
  }

  function games() {
    // --- 俄罗斯方块 ---
    var myCharts = echarts.init(document.getElementById('mainGames'))
    // app.title = '俄罗斯方块';
    var refreshT, fallBlockT;
    var fallTimout;
    var speed = 1000,
      downSpeed = 30,
      nomrlSpeed = 1000;
    var fallLine = 20,
      rlMove = 4,
      score = 0,
      death = false;

    var data = [],
      data2 = [];

    Array.prototype.clone = function () {
      var a = [];
      for (var i = 0, l = this.length; i < l; i++) {
        if (this[i] instanceof Array) {
          a.push(this[i].clone());
        } else {
          a.push(this[i]);
        }
      }
      return a;
    }

    var block1 = {
      basePt: [
        [0, 0],
        [0, 1],
        [1, 0],
        [1, 1]
      ],
      roate: function () {

      }
    };
    var block2 = {
      basePt: [
        [0, 0],
        [1, 0],
        [2, 0],
        [2, 1]
      ],
      shapList: [
        [
          [0, 0],
          [1, 0],
          [2, 0],
          [2, 1]
        ],
        [
          [0, 0],
          [0, 1],
          [0, 2],
          [1, 0]
        ],
        [
          [0, 0],
          [0, 1],
          [1, 1],
          [2, 1]
        ],
        [
          [0, 2],
          [1, 0],
          [1, 1],
          [1, 2]
        ]
      ],
      shapIndex: 0,
      roate: function () {
        this.shapIndex++;
        this.basePt = this.shapList[this.shapIndex % this.shapList.length].clone();
      }
    };
    var block3 = {
      basePt: [
        [0, 1],
        [1, 0],
        [1, 1],
        [2, 0]
      ],
      shapList: [
        [
          [0, 1],
          [1, 0],
          [1, 1],
          [2, 0]
        ],
        [
          [0, 0],
          [0, 1],
          [1, 1],
          [1, 2]
        ],
        [
          [0, 1],
          [1, 0],
          [1, 1],
          [2, 0]
        ],
        [
          [0, 0],
          [0, 1],
          [1, 1],
          [1, 2]
        ]
      ],
      shapIndex: 0,
      roate: function () {
        this.shapIndex++;
        this.basePt = this.shapList[this.shapIndex % this.shapList.length].clone();
      }
    };
    var block4 = {
      basePt: [
        [0, 0],
        [1, 0],
        [1, 1],
        [2, 1]
      ],
      shapList: [
        [
          [0, 0],
          [1, 0],
          [1, 1],
          [2, 1]
        ],
        [
          [0, 1],
          [0, 2],
          [1, 0],
          [1, 1]
        ]
      ],
      shapIndex: 0,
      roate: function () {
        this.shapIndex++;
        this.basePt = this.shapList[this.shapIndex % this.shapList.length].clone();
      }
    };
    var block5 = {
      basePt: [
        [0, 0],
        [0, 1],
        [1, 0],
        [2, 0]
      ],
      shapList: [
        [
          [0, 0],
          [0, 1],
          [1, 0],
          [2, 0]
        ],
        [
          [0, 0],
          [0, 1],
          [0, 2],
          [1, 2]
        ],
        [
          [0, 1],
          [1, 1],
          [2, 1],
          [2, 0]
        ],
        [
          [0, 0],
          [1, 0],
          [1, 1],
          [1, 2]
        ]
      ],
      shapIndex: 0,
      roate: function () {
        this.shapIndex++;
        this.basePt = this.shapList[this.shapIndex % this.shapList.length].clone();
      }
    };
    var block6 = {
      basePt: [
        [0, 0],
        [1, 0],
        [1, 1],
        [2, 0]
      ],
      shapList: [
        [
          [0, 0],
          [1, 0],
          [1, 1],
          [2, 0]
        ],
        [
          [0, 0],
          [0, 1],
          [0, 2],
          [1, 1]
        ],
        [
          [1, 0],
          [0, 1],
          [1, 1],
          [2, 1]
        ],
        [
          [0, 1],
          [1, 0],
          [1, 1],
          [1, 2]
        ]
      ],
      shapIndex: 0,
      roate: function () {
        this.shapIndex++;
        this.basePt = this.shapList[this.shapIndex % this.shapList.length].clone();
      }
    };
    var block7 = {
      basePt: [
        [-1, 0],
        [0, 0],
        [1, 0],
        [2, 0]
      ],
      shapList: [
        [
          [-1, 0],
          [0, 0],
          [1, 0],
          [2, 0]
        ],
        [
          [0, 0],
          [0, 1],
          [0, 2],
          [0, 3]
        ]
      ],
      shapIndex: 0,
      roate: function () {
        this.shapIndex++;
        this.basePt = this.shapList[this.shapIndex % this.shapList.length].clone();
      }
    };

    var blocks = [block1, block2, block3, block4, block5, block6, block7];

    var randomBlock = function () {
      var rnm = parseInt(Math.random() * 100) % 7;
      var blk = blocks[rnm];
      var ck = Math.random() * 6;
      for (var i = 0; i < ck; i++) {
        blk.roate();
      }
      return blk;
    };
    var firstBlock = randomBlock();
    // 全部方块
    for (var j = 0; j < 20; j++) {
      for (var i = 0; i < 10; i++) {
        data.push([i, j, 0]);
      }
    }

    var option = {
      backgroundColor: '#aaa',
      title: [{
          text: '俄罗斯方块'
        }, {
          text: "    当前得分：0",
          left: 550,
          top: '30%'
        },
        {
          text: "   ←、→ 左右移动\r\n\r\n↓ 加速下落，↑ 变形",
          left: 550,
          top: '60%'
        }
      ],
      grid: {
        show: true,
        borderColor: '#000',
        z: 2,
        top: 50,
        left: 200,
        height: 520,
        width: 260
      },
      legend: {
        show: false
      },
      xAxis: {
        interval: 2,
        splitLine: {
          lineStyle: {
            type: 'dashed'
          }
        },
        max: 10,
        axisTick: {
          show: false
        },
        axisLabel: {
          show: false
        },
        axisLine: {
          show: false
        }
      },
      yAxis: {
        interval: 2,
        splitLine: {
          lineStyle: {
            type: 'dashed'
          }
        },
        max: 20,
        axisTick: {
          show: false
        },
        axisLabel: {
          show: false
        },
        axisLine: {
          show: false
        }

      },
      series: [{
        data: data,
        type: 'scatter',
        symbol: 'rect',
        symbolSize: function (v) {
          return v[2] * 26;
        },
        symbolOffset: [13, -13],
        label: {
          emphasis: {
            show: false
          }
        },
        itemStyle: {
          normal: {
            shadowBlur: 10,
            shadowColor: 'rgba(120, 36, 50, 0.5)',
            shadowOffsetY: 5,
            color: new echarts.graphic.RadialGradient(0.4, 0.3, 1, [{
              offset: 0,
              color: 'rgb(251, 118, 123)'
            }, {
              offset: 1,
              color: 'rgb(204, 46, 72)'
            }])
          }
        }
      }, {
        data: data2,
        type: 'scatter',
        symbol: 'rect',
        symbolSize: function (v) {
          return v[2] * 26;
        },
        symbolOffset: [13, -13],
        label: {
          emphasis: {
            show: false
          }
        },
        itemStyle: {
          normal: {
            shadowBlur: 10,
            shadowColor: 'rgba(25, 100, 150, 0.5)',
            shadowOffsetY: 5,
            color: new echarts.graphic.RadialGradient(0.4, 0.3, 1, [{
              offset: 0,
              color: 'rgb(151, 218, 23)'
            }, {
              offset: 1,
              color: 'rgb(104, 100, 5)'
            }])
          }
        }
      }]
    };
    var touchDistortionOther = function () {
      var old_Pts = firstBlock.basePt.clone();
      firstBlock.roate();
      var isTouch = touchFallOther();
      firstBlock.basePt = old_Pts;
      firstBlock.shapIndex--;

      return isTouch;
    }

    var touchFallOther = function () {
      var pts = firstBlock.basePt.clone();

      for (var i = 0; i < pts.length; i++) {
        var da_i = pts[i][0] + rlMove;
        var da_j = pts[i][1] + fallLine;
        if (da_i < 0 || da_i >= 10) {
          return true;
        }
        if (option.series[0].data[da_j * 10 + da_i] && option.series[0].data[da_j * 10 + da_i][2] === 1) {
          return true;
        }
      }
      return false;
    }
    var touchLeftRightOther = function (lrOffset) {
      var pts = firstBlock.basePt.clone();
      var preLR_move = rlMove + lrOffset;

      for (var i = 0; i < pts.length; i++) {
        var da_i = pts[i][0] + preLR_move;
        var da_j = pts[i][1] + fallLine;
        if (da_i < 0 || da_i >= 10) {
          return true;
        }
        if (option.series[0].data[da_j * 10 + da_i] && option.series[0].data[da_j * 10 + da_i][2] === 1) {
          return true;
        }
      }
      return false;
    }
    var setScore = function () {
      for (var j = 0; j < 20; j++) {
        var rowBlok = 0;
        for (var i = 0; i < 10; i++) {
          rowBlok += option.series[0].data[j * 10 + i][2]
        }
        //消除一行
        if (rowBlok == 10) {
          for (var k = j + 1; k < 20; k++) {
            for (var m = 0; m < 10; m++) {
              option.series[0].data[(k - 1) * 10 + m][2] = option.series[0].data[k * 10 + m][2];
            }
          }
          score++;
          option.title[1].text = '    当前得分：' + score;
          j--;
        }
      }
    };
    var checkDeath = function () {
      for (var i = 0; i < 10; i++) {
        if (option.series[0].data[19 * 10 + i][2] === 1) {
          death = true;
          option.title[1].text = '游戏结束\r\n\r\n    本次得分：' + score;
        }
      }
    };
    refreshT = function () {
      var pts = firstBlock.basePt.clone();

      if (fallLine < 0 || touchFallOther()) {
        for (i = 0; i < pts.length; i++) {
          var da_i = pts[i][0] + rlMove;
          var da_j = pts[i][1] + fallLine + 1;
          if (option.series[0].data[da_j * 10 + da_i]) {
            option.series[0].data[da_j * 10 + da_i][2] = 1;
          }
        }
        myCharts.setOption(option);
        //计算得分
        setScore();
        checkDeath();
        option.series[1].data = [];
        firstBlock = randomBlock();
        rlMove = 4;
        fallLine = 20;
        speed = nomrlSpeed;
      } else {
        for (var i = 0; i < pts.length; i++) {
          //横轴移动4
          pts[i][0] += rlMove;
          pts[i][1] += fallLine;
          pts[i][2] = 1;
        }
        option.series[1].data = pts;
      }
      //停止下落，
      //   option.series[1].data = pts;
      //   option.series[0].data = data;
      myCharts.setOption(option);

    };

    fallBlockT = function () {
      if (death) return;
      fallLine--;
      refreshT();
      fallTimout = setTimeout(fallBlockT, speed);
    };
    fallBlockT();
    document.onkeydown = function (event) {
      if (event && event.keyCode === 37) {
        if (!touchLeftRightOther(-1)) {
          rlMove--;
          refreshT();
        }
      }
      if (event && event.keyCode === 40) {
        speed = downSpeed;
        clearTimeout(fallTimout);
        fallBlockT();
      }
      if (event && event.keyCode === 39) {
        if (!touchLeftRightOther(1)) {
          rlMove++;
          refreshT();
        }
      }
      //变形
      if (event && event.keyCode === 38) {
        if (!touchDistortionOther()) {
          firstBlock.roate();
          refreshT();
        }
      }
    }
    myCharts.setOption(option)
  }

  function demo() {

  }
</script>

</html>