<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>整改意见模板</title>
  <script src="../js/jquery.js"></script>
  <script src="../bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="../bootstrap-3.3.7-dist/css/bootstrap.css">
  <script src="../layui/layui.js"></script>
  <link rel="stylesheet" href="../layui/css/layui.css">
  <style>
    body {
      margin: 0 auto;
      max-width: 830px;
    }

    .pdf_model {
      padding: 5px 10px;
    }

    .table {
      table-layout: fixed;
    }

    .boxs {
      width: 814px;
    }

    .table,
    .table tr td {
      border: 1px solid rgb(0, 0, 0) !important;
    }

    .in_form {
      border: none;
      width: 100%;
    }

    .head_title {
      padding: 20px 0px;
    }

    .vertical_td {
      display: table-cell;
      vertical-align: middle !important;
      text-align: center;
    }

    .vertical_span {
      writing-mode: vertical-lr;
    }

    .input_text_box {
      overflow: hidden;
    }

    .exam_box {
      display: flex;
      justify-content: space-around;
      flex-wrap: nowrap;
      margin: 30px 0px;
      height: 200px;
    }


    .exam_left {
      position: relative;
      width: 30%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #gz {
      position: absolute;
      height: 200px;
      width: 200px;
      top: 0px;
      left: 0px;
    }

    .chance_message {
      margin-bottom: 20px;
    }

    .exam_right {
      width: 70%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .exam_title {
      line-height: 100px;
    }

    .exam_time {
      border: none;
      margin: 20px;
    }

    .stamp {
      width: 40%;
      height: 100px;
    }

    .rummager {
      width: 85%;
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .rummager_name_img {
      width: 90px;
      height: 90px;
      padding: 5px;
    }

    .in_form_short {
      border: none;
      width: 5%;
    }
  </style>
</head>

<body>
  <div>
    <div id="pdf_model" class="pdf_model ">
      <div class="container boxs">
        <div class="row">
          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="head_title">
              <h3 class="text-center"><strong>供热工程检查整改通知单</strong></h3>
            </div>
            <div class="detail_table">
              <table class="table table-condensed" id="tabProduct">
                <tr>
                  <td colspan="2">编号</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">归档号</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">用户名称</td>
                  <td colspan="6">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">用户地址</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">设计单位</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">所属供热区域</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">施工单位</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">检查项目</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">一次支网管径</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">设计参数</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">审图办结时间</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">供热面积</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">检查时间</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">热用途</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                  <td colspan="2">冲洗、试压情况</td>
                  <td colspan="2">
                    <div class="input_text_box">
                      <input class="in_form" id="" type="text" placeholder="请输入">
                    </div>
                  </td>
                </tr>
                <tr>
                  <td rowspan="3" class="vertical_td"><span class="vertical_span">检查情况</span></td>
                  <td class="clone" colspan="7" rowspan="3">
                    <textarea class="in_form" rows="10" placeholder=""></textarea>
                  </td>
                </tr>
                <tr></tr>
                <tr></tr>
                <tr></tr>
                <tr>
                  <td rowspan="3" class="vertical_td"><span class="vertical_span">整改意见</span></td>
                  <td class="clone" colspan="7" rowspan="3">
                    <div class="chance_message">
                      <textarea class="in_form" maxlength="" rows="15" placeholder=""></textarea>
                    </div>
                    <div class="exam_box">
                      <div class="exam_left">
                        <div class="exam_title"><span>盖章：</span></div>
                        <div class="stamp">
                          <div class="stamp_gz">
                            <img src="/img/rlyscgz.png" id="gz" alt="">
                          </div>
                        </div>
                      </div>
                      <div class="exam_right">
                        <div class="exam_title"><span>检查人：</span></div>
                        <div class="rummager">
                          <div class="rummager_name">
                            <img class="rummager_name_img" src="/img/dzqm_gt.png" alt="">
                          </div>
                          <div class="rummager_name">
                            <img class="rummager_name_img" src="/img/dzqm_lhj.png" alt="">
                          </div>
                          <div class="rummager_name">
                            <img class="rummager_name_img" src="/img/dzqm_zj.png" alt="">
                          </div>
                          <div class="rummager_name">
                            <img class="rummager_name_img" src="/img/dzqm_zpt.png" alt="">
                          </div>
                          <div class="rummager_name">
                            <img class="rummager_name_img" src="/img/dzqm_zyq.png" alt="">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="exam_time text-right">
                      <input class="in_form_short" id="" type="text" placeholder="XXXX">年
                      <input class="in_form_short" id="" type="text" placeholder="XX">月
                      <input class="in_form_short" id="" type="text" placeholder="XX">日
                    </div>
                  </td>
                </tr>
                <tr></tr>
                <tr></tr>
                <tr></tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <button id="sub">转出pdf</button>
  </div>
</body>
<script src="js/jquery.js"></script>
<script src="js/HtmlCanvas.js"></script>
<script src="js/JsPdf.js"></script>
<script>
  layui.use('layer', function () {
    var layer = layui.layer;

    $(function () {
      $("body").on("click", "#sub", function () {
        makeMpdf("文件")
      })
      $(".rummager").delegate(".rummager_name", "click", function () {
        //询问框
        var jcr = $(this).children()
        layer.confirm('确定删除此监察人吗？', {
          title: "提示",
          btn: ['确定', '取消'],
        }, function () {
          jcr.remove()
          layer.closeAll();
        });
      })
    })
  });

  function makeMpdf(pdfName) {
    if (confirm("您确认下载该PDF文件吗?")) {
      var target = document.getElementsByClassName("pdf_model")[0];
      console.log(target)
      target.style.background = "#FFFFFF";
      if (pdfName == '' || pdfName == undefined) pdfName = getNowFormatDate();

      html2canvas(target, {
        allowTaint: true,
        height: $("#pdf_model").outerHeight() + 20,
        onrendered: function (canvas) {
          var contentWidth = canvas.width;
          var contentHeight = canvas.height;
          // 一页pdf显示html页面生成的canvas高度;
          var pageHeight = contentWidth / 592.28 * 841.89;
          //未生成pdf的html页面高度
          var leftHeight = contentHeight;
          //页面偏移
          var position = 0;
          //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高  
          var imgWidth = 595.28;
          var imgHeight = 595.28 / contentWidth * contentHeight;

          var pageData = canvas.toDataURL('image/jpeg', 1.0);

          var pdf = new jsPDF('', 'pt', 'a4');

          //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89) 
          //当内容未超过pdf一页显示的范围，无需分页
          if (leftHeight < pageHeight) {
            pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight);
          } else {
            while (leftHeight > 0) {
              pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
              leftHeight -= pageHeight;
              position -= 841.89;
              //避免添加空白页
              if (leftHeight > 0) {
                pdf.addPage();
              }
            }
          }
          pdf.save(pdfName + ".pdf");

          //上传到后台
          var pdfData = pdf.output('datauristring') //获取到base64 的pdf
          // console.log(pageData)
          // console.log(pdfData)
        }
      })
    }
  }
  //将文件转成对象

  function dataURLtoFile(dataurl, filename) {
    var arr = dataurl.split(',');
    var mime = arr[0].match(/:(.*?);/)[1];
    var bstr = atob(arr[1]);
    var n = bstr.length;
    var u8arr = new Uint8Array(n);
    while (n--) {
      u8arr[n] = bstr.charCodeAt(n);
    }
    //转换成file对象
    return new File([u8arr], filename, {
      type: mime
    });
    //转换成成blob对象
    //return new Blob([u8arr],{type:mime});
  }

  $(document).keydown(function (event) {
    if ((event.ctrlKey === true || event.metaKey === true) &&
      (event.which === 189 || event.which === 187 ||
        event.which === 173 || event.which === 61 ||
        event.which === 107 || event.which === 109)) {
      event.preventDefault();
    }
  });

  $(window).bind('mousewheel DOMMouseScroll', function (event) {
    if (event.ctrlKey === true || event.metaKey) {
      event.preventDefault();
    }
  });

  window.addEventListener('mousewheel', function (event) {
    if (event.ctrlKey === true || event.metaKey) {
      event.preventDefault();
    }
  }, {
    passive: false
  });

  window.addEventListener('DOMMouseScroll', function (event) {
    if (event.ctrlKey === true || event.metaKey) {
      event.preventDefault();
    }
  }, {
    passive: false
  });
</script>

</html>